name: CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  workflow_dispatch:
  
env:
  GODOT_VERSION: 3.5.1
  EXPORT_NAME: heartless
  PROJECT_PATH: /

jobs:
  export-web:
      name: Web Export
      runs-on: ubuntu-20.04
      steps:
        - name: Checkout
          uses: actions/checkout@v2
          with:
            lfs: true
            
            
        - name: export game
          id: export
          # Use latest version (see releases for all versions)
          uses: firebelley/godot-export@v4.6.0
          with:
            godot_executable_download_url: https://github.com/godotengine/godot/releases/download/3.5.1-stable/Godot_v3.5.1-stable_linux_headless.64.zip
            godot_export_templates_download_url: https://github.com/godotengine/godot/releases/download/3.5.1-stable/Godot_v3.5.1-stable_export_templates.tpz
            relative_project_path: ./
            archive_output: true
        
        
        - name: Upload Artifact
          uses: actions/upload-artifact@v1
          with:
            name: web
            path: build/web
            
            
        - name: Install rsync ðŸ“š
          run: |
            apt-get update && apt-get install -y rsync
        - name: Deploy to GitHub Pages ðŸš€
          uses: JamesIves/github-pages-deploy-action@releases/v4
          with:
            branch: gh-pages # The branch the action should deploy to.
            folder: build/web # The folder the action should deploy.
            BUILD_FROM: main

